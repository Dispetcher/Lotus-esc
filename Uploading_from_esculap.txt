%REM
	Agent Uploading from esculap
	Created 20/12/2017 Dmitry Skoblikov
	Description: Comments for Agent
%END REM
Option Public
Option Declare
Use "PickListFromAnotherDB"

Public ExcelApp As Variant
Public ExcelSheet As Variant
Dim db As NotesDatabase
Dim s As NotesSession
Dim strError As String

Sub Initialize
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++
	Dim ws As New NotesUIWorkspace
	Dim ret, path$, i%

	' Ïîäêëþ÷åíèå ê Excel
	On Error Resume Next
	Set ExcelApp = CreateObject("Excel.Application")
	If Err()<>0 Then MsgBox "Excel íå óñòàíîâëåí": End
	On Error GoTo handler

	REM +++
	' Âûáèðàåì ôàéë äëÿ îòêðûòèÿ
	ret = ws.Openfiledialog(False, "Âûáîð ôàéëà", "Excel_2013|*.xlsx|Excel_2010|*.xls", "D:\", )
	If IsEmpty(ret) Then GoTo endh
	path = ret(0)
		
	'Îòêðûòèå ôàéëà
	On Error Resume Next
	Call ExcelApp.Workbooks.Add(path)
	If Err()<>0 Then Err=0 : Print "Îøèáêà ïðè îòêðûòèè " + path : GoTo endh
	On Error GoTo handler
	
	Set ExcelSheet = ExcelApp.Workbooks(1).Worksheets(1)
	If Err()<>0 Then Err=0 : Print "Îøèáêà ExcelApp.Workbooks(1).Worksheets(1) ïðè îòêðûòèè " : GoTo endh
	On Error GoTo handler
	
	
	' Îïðåäåëÿåì ÁÄ
	Set s = New NotesSession
	'Set db = s.CurrentDatabase
	
	For i=2 To 3
		Call FillProcess(i)
	Next i

	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â Ïðîöåäóðå { Initialize } èç Àãåíòà { Äîðìîñò Çàêà÷êà Ðååñòðà Excel }, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	Error Err, strError
endh:
End Sub
%REM
	Function fillegrul 21/12/17
	Description: ÅÃÐÞË
%END REM
Function FillEgrul(i%, unidorg$, opf$, pn$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++		
	Dim j%, tmp$, unid$, opffull$, uradr As Variant
	Dim doc As NotesDocument
	j=0

	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	
	
	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "22226VypiskaIzEGRJuL")
	
	
	'Íàèì äîêà
	Call doc.Replaceitemvalue("ObrazovanieNaimenDoc", "Ëèñò çàïèñè")
	'Êîìó âûäàí
	Call doc.Replaceitemvalue("KomuVydan", kn)	
	'Äàòà âûäà÷è
	Call doc.Replaceitemvalue("Date", Today())	
	'ÎÏÔ ïîëíîå

	' ÎÏÔ
	If opf = "ÎÀÎ" Then
		opffull = "Îòêðòûòîå àêöèîíåðíîå îáùåñòâî" 
	ElseIf opf = "ÇÀÎ" Then
		opffull = "Çàêðòûòîå àêöèîíåðíîå îáùåñòâî"
	ElseIf opf = "ÀÎ" Then
		opffull = "Àêöèîíåðíîå îáùåñòâî"	
	ElseIf opf = "ÎÎÎ" Then
		opffull = "Îáùåñòâî ñ îãðàíè÷åííîé îòâåòñòâåííîñòüþ"	
	ElseIf opf = "ÃÓÏ" Then
		opffull = "Ãîñóäàðñòâåííîå óíèòàðíîå ïðåäïðèÿòèå"		
	End If
	Call doc.Replaceitemvalue("OPF", opffull)
	'ÎÏÔ êðàòêîå
	Call doc.Replaceitemvalue("OPFmin", opf)	
	'Ïîëíîå íàèì
	Call doc.Replaceitemvalue("FullName", pn)
	'Êðàò íàèì
	Call doc.Replaceitemvalue("CropName", kn)
	'Íàèì îðãàíà - ãåí äèð
	Call doc.Replaceitemvalue("Organ", "Ãåíåðàëüíûé äèðåêòîð")
	'-----Þð àäðåñ-----
	tmp = ExcelSheet.Cells(i,37).Value
	uradr = Split(tmp, ",")
	'Èíäåêñ	
	Call doc.Replaceitemvalue("Indeks", uradr(j))
	'Ñòðàíà
	j=j+1
	Call doc.Replaceitemvalue("Strana", Trim(uradr(j)))
	'Ñóáúåêò
	j=j+1
	Call doc.Replaceitemvalue("SubjectRF", Trim(uradr(j)))
	'Ãîðîä
	j=j+1
	If Left(Trim(uradr(j)),1)="ã" Or Left(Trim(uradr(j)),3)="ïîñ" Then
		Call doc.Replaceitemvalue("City", Trim(uradr(j)))
		'Óëèöà
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Street", "")
			Else
			Call doc.Replaceitemvalue("Street", Trim(uradr(j)))
		End If		
		
		'Äîì
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Dom", "")
		Else
			Call doc.Replaceitemvalue("Dom", Trim(uradr(j)))
		End If		
		'Êîðïóñ
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Korpus", "")
		Else
			Call doc.Replaceitemvalue("Korpus", Trim(uradr(j)))
		End If			
		'Êâàðòèðà
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Kvartira", "")
		Else
			Call doc.Replaceitemvalue("Kvartira", Trim(uradr(j)))
		End If			
	Else
		j = 2
		Call doc.Replaceitemvalue("City", Trim(uradr(j)))
		'Óëèöà
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Street", "")
		Else
			Call doc.Replaceitemvalue("Street", Trim(uradr(j)))
		End If				
		'Äîì
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Dom", "")
		Else
			Call doc.Replaceitemvalue("Dom", Trim(uradr(j)))
		End If		
		'Êîðïóñ	
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Korpus", "")
		Else
			Call doc.Replaceitemvalue("Korpus", Trim(uradr(j)))
		End If			
		'Êâàðòèðà
		j=j+1
		If j>UBound(uradr) Then
			Call doc.Replaceitemvalue("Kvartira", "")
		Else
			Call doc.Replaceitemvalue("Kvartira", Trim(uradr(j)))
		End If		
	End If
	'Òëô
	tmp = ExcelSheet.Cells(i,15).Value
	Call doc.Replaceitemvalue("Tel", tmp)
	'Ôàêñ
	tmp = ExcelSheet.Cells(i,16).Value
	Call doc.Replaceitemvalue("Fax", tmp)
	
	'Äàòà äåéñòâèÿ
	Call doc.Replaceitemvalue("DeistvieData", DateNumber(2018,4,1))
	
	Call doc.Save(True, True, True)	

	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè FillEgrul}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
End Function
%REM
	Function fillinn 21/12/17
	Description: Ïðîòîêîë íàçíà÷åíèÿ ðóêîâîäèòåëÿ
%END REM
Function FillRuk(i As Integer, unidorg$, opf$, pn$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++	
	Dim unid$, tmp$, opffull$, y%, m%, d%, data$
	Dim tmp2 As Variant
	Dim doc As NotesDocument

	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	
	
	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "22217ProtokolNaznachRukov")
	
	'Íàèì äîêà
	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Ïðîòîêîë")
	'Äàòà äîêà
	Call doc.Replaceitemvalue("DataPodachiDokumenta", Today())
	' Êåì âûäàíî, Êðàòêîå íàèì
	Call doc.Replaceitemvalue("KemVidano", kn)
	' ÔÈÎ
	tmp = ExcelSheet.Cells(i,11).Value
	tmp2 = Split(tmp, " ")
	'Ôàì ðóê
	Call doc.Replaceitemvalue("Fam", tmp2(0))
	'Èìÿ ðóê
	Call doc.Replaceitemvalue("Name", tmp2(1))
	'Îò÷ ðóê
	Call doc.Replaceitemvalue("Otchstvo", tmp2(2))
	'Äîëæíîñòü ðóê
	tmp = ExcelSheet.Cells(i,12).Value
	Call doc.Replaceitemvalue("Dolzhnost", tmp)	
	'Äàòà ïîëíîìî÷èé
	Call doc.Replaceitemvalue("DatePolnOt", Today())	
	'Äàòà îêîí÷àíèé ïîëíîì
	y = Val(Year(Today()))+Val(3)
	m = Month(Today())
	d = Day(Today())
	data = DateNumber(y, m, d)
	Call doc.Replaceitemvalue("DatePolnDo",data)
	'Îáùåå êîë âî ëåò ïîëíîìî÷èé - 3 ïî óìîë÷àíèþ
	Call doc.Replaceitemvalue("DatePoln", "3")
	'Äàòà äåéñòâèÿ äîêà è ïîëíîìî÷èé
	Call doc.Replaceitemvalue("DeistvieData", data)
	Call doc.Save(True, True, True)		
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	strError = " Îøèáêà â { ôóíêöèè FillRuk}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
End Function		

%REM
	Function fillinn 21/12/17
	Description: ÈÍÍ
%END REM
Function fillinn(i%, unidorg$, opf$, pn$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++		
	Dim tmp$, unid$
	Dim doc As NotesDocument	
	
	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	
	
	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "22212SvidOPrisvoenii")
	
	'Íàèì äîêà
	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Ñâèäåòåëüñòâî î ïîñòàíîâêå íà íàëîãîâûé ó÷åò þðèäè÷åñêîãî ëèöà")
	'ÈÍÍ
	tmp = Val(ExcelSheet.Cells(i,2).Value)
	Call doc.Replaceitemvalue("INN", tmp)
	'ÊÏÏ
	tmp = Val(ExcelSheet.Cells(i,21).Value)
	Call doc.Replaceitemvalue("KPP", tmp)
	'Êåì âûäàíî
	Call doc.Replaceitemvalue("KemVidano", kn)	
	'Äàòà ïîñòàíîâêè íà ó÷åò
	tmp = ExcelSheet.Cells(i,33).Value
	If tmp="" Then
		tmp = DateValue(ExcelSheet.Cells(i,32).Value)
	Else
		tmp = DateValue(tmp)
	End If	
	Call doc.Replaceitemvalue("DatePostanovki", tmp)
		
	Call doc.Save(True, True, True)
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè FillINN}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:	
End Function
%REM
	Function fillogrn 21/12/17
	Description: ÎÃÐÍ
%END REM
Function fillogrn(i%, unidorg$, opf$, pn$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++		
	Dim tmp$, unid$
	Dim doc As NotesDocument	
	
	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	
	
	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "22211SvidPrisvoenOGRN")
		
	'Íàèì äîêà
	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Ñâèäåòåëüñòâî î ãîñóäàðñòâåííîé ðåãèñòðàöèè þðèäè÷åñêîãî ëèöà")
	'ÎÃÐÍ
	tmp = Val(ExcelSheet.Cells(i,20).Value)
	Call doc.Replaceitemvalue("OGRN", tmp)
	'Êåì âûäàíî
	Call doc.Replaceitemvalue("KemVidano", kn)	
	'Äàòà âíåñåíèÿ ÎÃÐÍ
	tmp = ExcelSheet.Cells(i,33).Value
	If tmp="" Then
		tmp = DateValue(ExcelSheet.Cells(i,32).Value)
	Else
		tmp = DateValue(tmp)
	End If	
	Call doc.Replaceitemvalue("DateVnesenieOGRN", tmp)
	'Äàòà ðåã ïðåäïðèÿòèÿ
	tmp = ExcelSheet.Cells(i,32).Value
	Call doc.Replaceitemvalue("DateRegPredpr", tmp)
	
	Call doc.Save(True, True, True)
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè FillOGRN}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:	
End Function
%REM
	Function fillank 20/12/17
	Description: Àíêåòà
%END REM
Function FillAnk(i As Integer, unidorg$, opf$, pn$, kn$, datecrt$ )
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++	
	Dim unid$, tmp$, tmp2$, opffull$
	Dim doc As NotesDocument
	On Error Resume Next
	
	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	

	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "2214Anketa")
	
	'Íàèì äîêóìåíòà
	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Ñâåäåíèÿ îá îðãàíèçàöèè")	
	'Äàòà äîêóìåíòà
	Call doc.Replaceitemvalue("DataPodachiDokumenta", Today())	
	' Êåì âûäàíî
	Call doc.Replaceitemvalue("KemVidano", kn)
	'Ïîëíîå
	Call doc.Replaceitemvalue("PolnoeNaimenovanieOrg", pn)	
	'Êðàòêîå
	Call doc.Replaceitemvalue("OrgChlenSROÒName1", kn)	
	'Ïðåäûäóù íàèì
	Call doc.Replaceitemvalue("PolnoeNaimenovanieOrgOld", "")
	'Ãîä ñîçäàíèÿ
	Call doc.Replaceitemvalue("YearCompany", Year(DateValue(datecrt)))
	'Þð àäðåñ
	tmp = ExcelSheet.Cells(i,37).Value
	Call doc.Replaceitemvalue("JurAdres", tmp)	
	'Ôàêò àäðåñ
	tmp = ExcelSheet.Cells(i,39).Value
	Call doc.Replaceitemvalue("FactAdres", tmp)	
	'ÒËÔ
	tmp = ExcelSheet.Cells(i,15).Value
	Call doc.Replaceitemvalue("Phone", tmp)	
	'Ôàêñ
	tmp = ExcelSheet.Cells(i,16).Value
	Call doc.Replaceitemvalue("Fax", tmp)	
	'Ìýéë
	tmp = ExcelSheet.Cells(i,17).Value
	Call doc.Replaceitemvalue("Email", tmp)	
	'Ñàéò
	tmp = ExcelSheet.Cells(i,18).Value
	Call doc.Replaceitemvalue("www", tmp)	
	'Êîíò ëèöî
	Call doc.Replaceitemvalue("FIOKontaktnogoLica", "")	
	'Êîë âî ñîòðóäíèêîâ
	tmp = ExcelSheet.Cells(i,65).Value
	Call doc.Replaceitemvalue("Vsego", tmp)	
	'ÐÍÏ
	Call doc.Replaceitemvalue("RNP", "íåò")	
	'Áàíêðîòñòâî
	Call doc.Replaceitemvalue("Bankrot", "íåò")	
	
	Call doc.Replaceitemvalue("DeistvieData", DateNumber(2018,4,1))	
	
	Call doc.Save(True, True, True)	
	
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè FillAnk}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
End Function	
%REM
	Function fillinn 20/12/17
	Description: Ãîëîâíàÿ ôîðìà Ïðîöåññ-OrgChlenSRO
%END REM
Function FillProcess(i As Integer)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++	
	Dim unidorg$, tmp$, tmp2$, opf$, pn$, kn$, datecrt$
	Dim doc As NotesDocument
	On Error Resume Next

	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()
	
	
	
	' Çàïîëíÿåì UNID
	unidorg =  doc.Universalid 
	Call doc.Replaceitemvalue("UNID", unidorg)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "OrgChlenSRO")
	' Ñòàâèì äåéñòâóþùóþ îðãàíèçàöèþ
	Call doc.Replaceitemvalue("OrgStatus", "2" )
	Call doc.Replaceitemvalue("FromCandidatToChlen", "1" )

	
	' Ïîëíîå íàèì îðã
	' ÎÏÔ
	opf = ExcelSheet.Cells(i,6).Value
	opf = FullTrim(opf)
	' ×àñòü ïîëí. íàèìåíîâàíèÿ
	pn = ExcelSheet.Cells(i,9).Value
	pn = FullTrim(pn)
	
	pn = opf + " " + pn
	Call doc.Replaceitemvalue("OrgChlenSROÒName", pn)	
	Call doc.Replaceitemvalue("PolnoeNaimenovanieOrg", pn)
	
	' Êðàòêîå íàèìåíîâàíèå
	kn = ExcelSheet.Cells(i,10).Value
	kn = FullTrim(kn)
	
	kn = opf + " " + kn
	Call doc.Replaceitemvalue("OrgChlenSROÒName_1", kn)	
	
	'Äàòà âñòóïëåíèÿ
	datecrt = DateValue(ExcelSheet.Cells(i,22).Value)
	Call doc.Replaceitemvalue("DatePrinVNP", datecrt)	
	
	'Íîìåð ðåøåíèÿ
	tmp = Val(ExcelSheet.Cells(i,23).Value)
	Call doc.Replaceitemvalue("NumResh", tmp)
	
	'Äàòà ðåã â ðååñòðå ÑÐÎ
	tmp = DateValue(ExcelSheet.Cells(i,24).Value)
	Call doc.Replaceitemvalue("DateRegistr", tmp)
	
	' Íîìåð ðåã çàïèñè - íîìåð ðååñòðà
	tmp = ExcelSheet.Cells(i,1).Value
	tmp = FullTrim(tmp)
	If Len(tmp)=1 Then
		tmp = "00" + tmp
	ElseIf Len(tmp)=2 Then
		tmp = "0" + tmp
	End If
	Call doc.Replaceitemvalue("NomerRegistracionnojZapisi", tmp)

	Call doc.Save(True, True, True)
	
	REM Çàïóñêàåì ôóíêöèþ çàïîëí äîêóìåíòîâ
	Call FillAnk(i, unidorg, opf, pn, kn, datecrt)
	Call FillRuk(i, unidorg, opf, pn, kn)
	Call FillEgrul(i, unidorg, opf, pn, kn)
	Call Fillogrn(i, unidorg, opf, pn, kn)
	Call Fillinn(i, unidorg, opf, pn, kn)
	Call Filllicense(i, unidorg, opf, pn, kn)
	Call Filllevelotv(i, unidorg, opf, pn, kn)
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè FillProcess}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
End Function

%REM
	Function header 22/12/2017
	Description: Çàïîëíåíèå øàïêè êàæäîãî äîêóìåíòà
%END REM
Function header(doc As NotesDocument, pn$, unidorg$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM ----
	Dim unid$
	
	' UNID doc
	unid =  doc.Universalid 
	Call doc.Replaceitemvalue("UNID", unid)
	' OrgChlenSROTName
	Call doc.Replaceitemvalue("OrgChlenSROÒName", pn)	
	' OrgChlenSROUNID
	Call doc.Replaceitemvalue("OrgChlenSROUNID", unidorg)
	' OrgChlenSROTName
	Call doc.Replaceitemvalue("OrgChlenSROÒNameShow", kn)	
	
	REM ----
	GoTo endh
handler:
	strError = " Îøèáêà â { ôóíêöèè header}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
	
End Function
%REM
	Function filllicense 22/12/17
	Description: Ëèöåíçèè
%END REM
Function filllicense(i%, unidorg$, opf$, pn$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++		
	Dim tmp$, tmp2$, unid$, j%, n%
	Dim doc As NotesDocument
	Dim arr, tmparr As Variant	
	
	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	
	'Çàïóñêàåì öèêë ïî ýë-òàì ìàññèâà èç ëèöåíçèé
	tmp = ExcelSheet.Cells(i,34).Value
	arr = Split(tmp, "¹")
	n = UBound(arr)
	
	For j=1 To UBound(arr)
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	
	
	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "22232LicenziiNaVidyRabot")
	
	'Íàèì äîêà
	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Ëèöåíçèÿ")
	'Íîìåð ëèöåíçèè
	tmparr = Split(arr(j), "îò")
	Call doc.Replaceitemvalue("Licenz_Nomer", "¹ " + tmparr(0))
	'Äàòà âûäà÷è - ñåãîäíÿ
	tmp2 = tmparr(1)
	Call doc.Replaceitemvalue("DataVydachi", tmp2)
	'Ñòàòóñ ëèöåíçèè - ïðåêðàùåíî
	Call doc.Replaceitemvalue("ViewLicense", "Ïðåêðàùåíî")
	
	Call doc.Save(True, True, True)
Next j
	
	
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè FillLicense}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
End Function
%REM
	Function filllevelotv 22/12/17
	Description: Óðîâíè îòâåòñòâåííîñòè
%END REM
Function filllevelotv(i%, unidorg$, opf$, pn$, kn$)
	On Error GoTo handler 'îáðàáîò÷èê îøèáîê
	REM +++++++++++++++++++++++++++++		
	Dim tmp$, tmp2$
	Dim doc As NotesDocument	
	
	' Îïðåäåëÿåì ÁÄ
	Set db = s.Currentdatabase
	' Ñîçäàåì äîêóìåíò â ÁÄ
	Set doc = db.Createdocument()	
	
	Call header(doc, pn, unidorg, kn)
	' Îïðåäåëÿåì èìÿ ôîðìû
	Call doc.Replaceitemvalue("Form", "2271ZayavUrovnOtvetstv")
	
	'Íàèì äîêà

	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Çàÿâëåíèå îá óðîâíÿõ îòâåòñòâåííîñòè")
	'Äàòà äîêà
	Call doc.Replaceitemvalue("DocDate", Today())
	'Óðîâåíò îòâ ÂÂ
	tmp = Trim(ExcelSheet.Cells(i,75).Value)
	Call doc.Replaceitemvalue("KFVV_UrovnOtvetstvNum", tmp)
	'Ìàêñ ñóììà ïî ÂÂ
	Select Case tmp
		Case "Ïåðâûé" 
			Call doc.Replaceitemvalue("KFVV_StoimostDogovora", "íå ïðåâûøàåò 60 ìëí. ðóá.")
			Call doc.Replaceitemvalue("KFVV_MinRazmerVznosa", 100000)
		Case "Âòîðîé" 
			Call doc.Replaceitemvalue("KFVV_StoimostDogovora", "íå ïðåâûøàåò 500 ìëí. ðóá.")
			Call doc.Replaceitemvalue("KFVV_MinRazmerVznosa", 500000)
		Case "Òðåòèé" 
			Call doc.Replaceitemvalue("KFVV_StoimostDogovora", "íå ïðåâûøàåò 3 ìëðä. ðóá.")
			Call doc.Replaceitemvalue("KFVV_MinRazmerVznosa", 1500000)
		Case "×åòâåðòûé" 
			Call doc.Replaceitemvalue("KFVV_StoimostDogovora", "íå ïðåâûøàåò 10 ìëðä. ðóá.")
			Call doc.Replaceitemvalue("KFVV_MinRazmerVznosa", 2000000)
		Case "Ïÿòûé" 
			Call doc.Replaceitemvalue("KFVV_StoimostDogovora", "ñîñòàâëÿåò 10 ìëðä. ðóá. è áîëåå")
			Call doc.Replaceitemvalue("KFVV_MinRazmerVznosa", 5000000)
	End Select
	'Óð îòâåò ïî ÎÄÎ
	tmp = Trim(ExcelSheet.Cells(i,76).Value)
	Call doc.Replaceitemvalue("KFODO_UrovnOtvetstvNum", tmp)
	'Ìàêñ ñóììà ïî ÎÄÎ
	Select Case tmp
		Case "Ïåðâûé" 
			Call doc.Replaceitemvalue("KFODO_StoimostDogovora", "íå ïðåâûøàåò 60 ìëí. ðóá.")
			Call doc.Replaceitemvalue("KFODO_MinRazmerVznosa", 2000000)
		Case "Âòîðîé" 
			Call doc.Replaceitemvalue("KFODO_StoimostDogovora", "íå ïðåâûøàåò 500 ìëí. ðóá.")
			Call doc.Replaceitemvalue("KFODO_MinRazmerVznosa", 25000000)
		Case "Òðåòèé" 
			Call doc.Replaceitemvalue("KFODO_StoimostDogovora", "íå ïðåâûøàåò 3 ìëðä. ðóá.")
			Call doc.Replaceitemvalue("KFODO_MinRazmerVznosa", 45000000)
		Case "×åòâåðòûé" 
			Call doc.Replaceitemvalue("KFODO_StoimostDogovora", "íå ïðåâûøàåò 10 ìëðä. ðóá.")
			Call doc.Replaceitemvalue("KFODO_MinRazmerVznosa", 70000000)
		Case "Ïÿòûé" 
			Call doc.Replaceitemvalue("KFODO_StoimostDogovora", "ñîñòàâëÿåò 10 ìëðä. ðóá. è áîëåå")
			Call doc.Replaceitemvalue("KFODO_MinRazmerVznosa", 25000000)
	End Select
	
=======
	Call doc.Replaceitemvalue("NaimenovanieDokumenta", "Ñâèäåòåëüñòâî î ãîñóäàðñòâåííîé ðåãèñòðàöèè þðèäè÷åñêîãî ëèöà")
	'ÎÃÐÍ
	tmp = Val(ExcelSheet.Cells(i,20).Value)
	Call doc.Replaceitemvalue("OGRN", tmp)
	'Êîìó âûäàíî
	Call doc.Replaceitemvalue("KomuVydan", kn)	
	'Äàòà âíåñåíèÿ ÎÃÐÍ
	tmp = DateValue(ExcelSheet.Cells(i,33).Value)
	Call doc.Replaceitemvalue("DateVnesenieOGRN", tmp)
	'Äàòà ðåã ïðåäïðèÿòèÿ
	tmp = DateValue(ExcelSheet.Cells(i,32).Value)
	Call doc.Replaceitemvalue("DateRegPredpr", tmp)

	
	Call doc.Save(True, True, True)
	REM +++++++++++++++++++++++++++++
	GoTo endh
handler:
	ExcelApp.DisplayAlerts = False
	ExcelApp.Quit
	Dim strError As String
	strError = " Îøèáêà â { ôóíêöèè Filllevelotv}, ñòðîêà " + CStr(Erl) + Chr(10) + Error$
	'Error Err, strError
	MsgBox strError
	End
endh:
End Function